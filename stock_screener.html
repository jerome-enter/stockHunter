<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì£¼ì‹ë‹¨íƒ€ ìµœê°•ì•ˆì •í™” ê²€ìƒ‰ê¸°</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: linear-gradient(to bottom right, #0f172a, #1e3a8a, #0f172a);
      min-height: 100vh;
    }
  </style>
</head>
<body class="p-4 md:p-6">
  <div id="app" class="max-w-7xl mx-auto"></div>

  <script>
    const app = {
      selectedMarket: 'domestic',  // domestic or us
      conditions: {
        market: 'domestic',
        exchangeCode: 'KRX',  // KRX(êµ­ë‚´), NAS(ë‚˜ìŠ¤ë‹¥), NYS(ë‰´ìš•)
        excludeManagement: false,
        ma60Enabled: false,
        ma60Min: 95,
        ma60Max: 105,
        ma112Enabled: true,
        ma112Min: 95,
        ma112Max: 105,
        ma224Enabled: false,
        ma224Min: 95,
        ma224Max: 105,
        excludeETF: true,
        excludeETN: true,
        volumeEnabled: false,
        volumeMultiple: 1.5,
        maAlignment: false,
        bbEnabled: false,
        bbPeriod: 20,
        bbMultiplier: 2,
        bbPosition: 'all',
        bbUpperBreak: false,
        bbLowerBreak: false,
        priceChangeEnabled: false,
        priceChangeMin: -100,
        priceChangeMax: 100,
        marketCapEnabled: false,
        marketCapMin: 0,
        marketCapMax: 10000000000000,
        perEnabled: false,
        perMin: 0,
        perMax: 30,
        pbrEnabled: false,
        pbrMin: 0,
        pbrMax: 3,
      },
      appKey: '',
      appSecret: '',
      accessToken: '',
      results: [],
      loading: false,
      error: ''
    };

    // FastAPI ë°±ì—”ë“œ URL (ê°™ì€ ì„œë²„ ì‚¬ìš©)
    const API_BASE_URL = window.location.origin;

    async function validateCredentials() {
      try {
        const response = await fetch(`${API_BASE_URL}/api/v1/validate-credentials`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            appKey: app.appKey,
            appSecret: app.appSecret
          })
        });
        
        const data = await response.json();
        if (data.valid) {
          app.error = '';
          return true;
        } else {
          throw new Error(data.message || 'ì¸ì¦ ì‹¤íŒ¨');
        }
      } catch (err) {
        app.error = 'API ì¸ì¦ ì‹¤íŒ¨: ' + err.message;
        render();
        return false;
      }
    }

    // ê¸°ìˆ ì  ì§€í‘œ ê³„ì‚° í•¨ìˆ˜ë“¤ì€ ë°±ì—”ë“œì—ì„œ ì²˜ë¦¬ë˜ë¯€ë¡œ ì œê±°ë¨

    async function runScreener() {
      if (!app.appKey || !app.appSecret) {
        app.error = 'APP KEYì™€ APP SECRETì„ ì…ë ¥í•´ì£¼ì„¸ìš”';
        render();
        return;
      }

      app.loading = true;
      app.error = '';
      app.results = [];
      render();

      try {
        // FastAPI ë°±ì—”ë“œë¡œ ìŠ¤í¬ë¦¬ë‹ ìš”ì²­ ì „ì†¡
        const response = await fetch(`${API_BASE_URL}/api/v1/screen`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            appKey: app.appKey,
            appSecret: app.appSecret,
            ...app.conditions
          })
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error || errorData.detail || 'ìŠ¤í¬ë¦¬ë‹ ì‹¤íŒ¨');
        }

        const result = await response.json();
        
        // ê²°ê³¼ ë³€í™˜ (ë°±ì—”ë“œ ì‘ë‹µ í˜•ì‹ì— ë§ê²Œ)
        app.results = result.stocks.map(stock => ({
          code: stock.code,
          name: stock.name,
          currentPrice: stock.currentPrice,
          changePercent: stock.changePercent,
          ma5: stock.ma5,
          ma20: stock.ma20,
          ma60: stock.ma60,
          ma112: stock.ma112,
          ma224: stock.ma224,
          ma60Ratio: stock.ma60Ratio,
          ma112Ratio: stock.ma112Ratio,
          ma224Ratio: stock.ma224Ratio,
          bbPosition: stock.bbPosition,
          currentVolume: stock.volume,
          volumeRatio: stock.volumeRatio,
          maAlignment: stock.maAlignment
        }));

        console.log(`ìŠ¤í¬ë¦¬ë‹ ì™„ë£Œ: ${result.matchedCount}/${result.totalScanned} ì¢…ëª© (${result.executionTimeMs}ms)`);
        
      } catch (err) {
        app.error = 'ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + err.message;
        console.error('Screening error:', err);
      } finally {
        app.loading = false;
        render();
      }
    }

    function render() {
      const appDiv = document.getElementById('app');
      appDiv.innerHTML = `
        <div class="text-center mb-8">
          <h1 class="text-3xl md:text-4xl font-bold text-white mb-2">ğŸ“ˆ ì£¼ì‹ ì¡°ê±´ ê²€ìƒ‰ê¸°</h1>
          <p class="text-blue-200">ê¸°ìˆ ì  ë¶„ì„ ê¸°ë°˜ ì¢…ëª© ìŠ¤í¬ë¦¬ë‹</p>
        </div>

        <div class="bg-white/10 backdrop-blur-md rounded-xl p-4 md:p-6 mb-6 border border-white/20">
          <h2 class="text-lg md:text-xl font-bold text-white mb-4">ğŸ”‘ í•œêµ­íˆ¬ìì¦ê¶Œ API ì„¤ì •</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <label class="block text-sm font-medium text-blue-200 mb-2">APP KEY</label>
              <input type="text" id="appKey" value="${app.appKey}" placeholder="APP KEY ì…ë ¥"
                class="w-full px-4 py-2 bg-white/20 border border-white/30 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-400">
            </div>
            <div>
              <label class="block text-sm font-medium text-blue-200 mb-2">APP SECRET</label>
              <input type="password" id="appSecret" value="${app.appSecret}" placeholder="APP SECRET ì…ë ¥"
                class="w-full px-4 py-2 bg-white/20 border border-white/30 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-400">
            </div>
          </div>
          <div class="text-sm text-blue-200 bg-blue-900/30 p-3 rounded-lg">
            <strong>API í‚¤ ë°œê¸‰:</strong> í•œêµ­íˆ¬ìì¦ê¶Œ í™ˆí˜ì´ì§€ â†’ KIS Developers â†’ ì•± ë“±ë¡
          </div>
        </div>

        <div class="bg-white/10 backdrop-blur-md rounded-xl p-4 md:p-6 mb-6 border border-white/20">
          <h2 class="text-lg md:text-xl font-bold text-white mb-4">âš™ï¸ ì¡°ê±´ì„¤ì •</h2>
          
          <div class="mb-6">
            <h3 class="text-base md:text-lg font-semibold text-blue-200 mb-3">ì œì™¸ ì¡°ê±´</h3>
            <div class="grid grid-cols-2 gap-3">
              <label class="flex items-center gap-2 text-white cursor-pointer text-sm">
                <input type="checkbox" id="excludeManagement" ${app.conditions.excludeManagement ? 'checked' : ''} class="w-4 h-4">
                <span>ê´€ë¦¬ì¢…ëª©/íˆ¬ìê²½ê³ </span>
              </label>
              <label class="flex items-center gap-2 text-white cursor-pointer text-sm">
                <input type="checkbox" id="excludeETF" ${app.conditions.excludeETF ? 'checked' : ''} class="w-4 h-4">
                <span>ETF/ETN ì œì™¸</span>
              </label>
            </div>
          </div>

          <div class="mb-6">
            <h3 class="text-base md:text-lg font-semibold text-blue-200 mb-3">ì´ë™í‰ê· ì„ </h3>
            <div class="space-y-3">
              ${[
                { key: 'ma60', label: '60ì¼' },
                { key: 'ma112', label: '112ì¼' },
                { key: 'ma224', label: '224ì¼' }
              ].map(ma => `
                <div class="flex items-center gap-2 flex-wrap">
                  <label class="flex items-center gap-2 text-white cursor-pointer text-sm">
                    <input type="checkbox" id="${ma.key}Enabled" ${app.conditions[ma.key + 'Enabled'] ? 'checked' : ''} class="w-4 h-4">
                    <span>${ma.label} ì´í‰ Â±</span>
                  </label>
                  <input type="number" id="${ma.key}Min" value="${app.conditions[ma.key + 'Min']}" 
                    class="w-16 px-2 py-1 bg-white/20 border border-white/30 rounded text-white text-sm"
                    ${!app.conditions[ma.key + 'Enabled'] ? 'disabled' : ''}>
                  <span class="text-white">~</span>
                  <input type="number" id="${ma.key}Max" value="${app.conditions[ma.key + 'Max']}" 
                    class="w-16 px-2 py-1 bg-white/20 border border-white/30 rounded text-white text-sm"
                    ${!app.conditions[ma.key + 'Enabled'] ? 'disabled' : ''}>
                  <span class="text-blue-300 text-sm">%</span>
                </div>
              `).join('')}
            </div>
          </div>

          <div class="mb-6">
            <h3 class="text-base md:text-lg font-semibold text-blue-200 mb-3">ë³¼ë¦°ì € ë°´ë“œ</h3>
            <div class="space-y-3">
              <label class="flex items-center gap-2 text-white cursor-pointer text-sm">
                <input type="checkbox" id="bbEnabled" ${app.conditions.bbEnabled ? 'checked' : ''} class="w-4 h-4">
                <span>BB ì¡°ê±´ ì‚¬ìš©</span>
              </label>
              
              <div class="space-y-2 ml-6 ${!app.conditions.bbEnabled ? 'opacity-50' : ''}">
                <div class="text-sm text-blue-300 mb-2">ì „ëµ ì„ íƒ:</div>
                <label class="flex items-center gap-2 text-white cursor-pointer text-sm">
                  <input type="radio" name="bbPreset" value="short" 
                    ${app.conditions.bbPeriod === 10 && app.conditions.bbMultiplier === 1.5 ? 'checked' : ''}
                    ${!app.conditions.bbEnabled ? 'disabled' : ''} class="w-4 h-4">
                  <span>ë‹¨ê¸° íŠ¸ë ˆì´ë”© (10ì¼, Â±1.5Ïƒ) - ë¯¼ê°í•˜ê²Œ ë°˜ì‘</span>
                </label>
                <label class="flex items-center gap-2 text-white cursor-pointer text-sm">
                  <input type="radio" name="bbPreset" value="normal" 
                    ${app.conditions.bbPeriod === 20 && app.conditions.bbMultiplier === 2 ? 'checked' : ''}
                    ${!app.conditions.bbEnabled ? 'disabled' : ''} class="w-4 h-4">
                  <span>ì¼ë°˜ì  (20ì¼, Â±2Ïƒ) - ê°€ì¥ ë§ì´ ì‚¬ìš© â­</span>
                </label>
                <label class="flex items-center gap-2 text-white cursor-pointer text-sm">
                  <input type="radio" name="bbPreset" value="long" 
                    ${app.conditions.bbPeriod === 30 && app.conditions.bbMultiplier === 3 ? 'checked' : ''}
                    ${!app.conditions.bbEnabled ? 'disabled' : ''} class="w-4 h-4">
                  <span>ì¥ê¸° íˆ¬ì (30ì¼, Â±3Ïƒ) - ì•ˆì •ì </span>
                </label>
              </div>
              
              <select id="bbPosition" class="px-3 py-1 bg-white/20 border border-white/30 rounded text-white text-sm"
                ${!app.conditions.bbEnabled ? 'disabled' : ''}>
                <option value="all" ${app.conditions.bbPosition === 'all' ? 'selected' : ''}>ìœ„ì¹˜ ë¬´ê´€</option>
                <option value="lower" ${app.conditions.bbPosition === 'lower' ? 'selected' : ''}>í•˜ë‹¨ ë°´ë“œ ê·¼ì²˜ (ê³¼ë§¤ë„)</option>
                <option value="middle" ${app.conditions.bbPosition === 'middle' ? 'selected' : ''}>ì¤‘ê°„ ë°´ë“œ ê·¼ì²˜</option>
                <option value="upper" ${app.conditions.bbPosition === 'upper' ? 'selected' : ''}>ìƒë‹¨ ë°´ë“œ ê·¼ì²˜ (ê³¼ë§¤ìˆ˜)</option>
              </select>
              
              <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mt-3">
                <label class="flex items-center gap-2 text-white cursor-pointer text-sm">
                  <input type="checkbox" id="bbUpperBreak" ${app.conditions.bbUpperBreak ? 'checked' : ''} class="w-4 h-4">
                  <span>ìƒë‹¨ ë°´ë“œ ëŒíŒŒ (ê°•í•œ ìƒìŠ¹)</span>
                </label>
                <label class="flex items-center gap-2 text-white cursor-pointer text-sm">
                  <input type="checkbox" id="bbLowerBreak" ${app.conditions.bbLowerBreak ? 'checked' : ''} class="w-4 h-4">
                  <span>í•˜ë‹¨ ë°´ë“œ í„°ì¹˜ (ë°˜ë“± ê¸°íšŒ)</span>
                </label>
              </div>
              
              <div class="text-xs text-blue-300 bg-blue-900/20 p-2 rounded mt-2">
                ğŸ’¡ ìƒë‹¨ ëŒíŒŒ: ì£¼ê°€ > ìƒë‹¨ ë°´ë“œ | í•˜ë‹¨ í„°ì¹˜: ì£¼ê°€ â‰¤ í•˜ë‹¨ ë°´ë“œ
              </div>
            </div>
          </div>

          <div class="mb-6">
            <h3 class="text-base md:text-lg font-semibold text-blue-200 mb-3">ê±°ë˜ëŸ‰</h3>
            <div class="flex items-center gap-2 flex-wrap">
              <label class="flex items-center gap-2 text-white cursor-pointer text-sm">
                <input type="checkbox" id="volumeEnabled" ${app.conditions.volumeEnabled ? 'checked' : ''} class="w-4 h-4">
                <span>í‰ê·  ëŒ€ë¹„</span>
              </label>
              <input type="number" step="0.1" id="volumeMultiple" value="${app.conditions.volumeMultiple}" 
                class="w-20 px-2 py-1 bg-white/20 border border-white/30 rounded text-white text-sm"
                ${!app.conditions.volumeEnabled ? 'disabled' : ''}>
              <span class="text-blue-300 text-sm">ë°°</span>
            </div>
          </div>

          <div class="mb-6">
            <h3 class="text-base md:text-lg font-semibold text-blue-200 mb-3">ê°€ê²© ë³€ë™</h3>
            <div class="space-y-2">
              <label class="flex items-center gap-2 text-white cursor-pointer text-sm">
                <input type="checkbox" id="priceChangeEnabled" ${app.conditions.priceChangeEnabled ? 'checked' : ''} class="w-4 h-4">
                <span>ë“±ë½ë¥  ë²”ìœ„</span>
              </label>
              <div class="flex items-center gap-2 ml-6">
                <input type="number" step="0.1" id="priceChangeMin" value="${app.conditions.priceChangeMin}" 
                  class="w-20 px-2 py-1 bg-white/20 border border-white/30 rounded text-white text-sm"
                  ${!app.conditions.priceChangeEnabled ? 'disabled' : ''}>
                <span class="text-white">~</span>
                <input type="number" step="0.1" id="priceChangeMax" value="${app.conditions.priceChangeMax}" 
                  class="w-20 px-2 py-1 bg-white/20 border border-white/30 rounded text-white text-sm"
                  ${!app.conditions.priceChangeEnabled ? 'disabled' : ''}>
                <span class="text-blue-300 text-sm">%</span>
              </div>
            </div>
          </div>

          <div class="mb-6">
            <h3 class="text-base md:text-lg font-semibold text-blue-200 mb-3">ì¶”ê°€ ì¡°ê±´</h3>
            <div class="space-y-2">
              <label class="flex items-center gap-2 text-white cursor-pointer text-sm">
                <input type="checkbox" id="maAlignment" ${app.conditions.maAlignment ? 'checked' : ''} class="w-4 h-4">
                <span>ì´í‰ì„  ì •ë°°ì—´ (5 > 20 > 60 > 112)</span>
              </label>
            </div>
          </div>

          <div class="mb-6">
            <h3 class="text-base md:text-lg font-semibold text-blue-200 mb-3">ì‹œê°€ì´ì•¡ (ì–µì›)</h3>
            <div class="space-y-2">
              <label class="flex items-center gap-2 text-white cursor-pointer text-sm">
                <input type="checkbox" id="marketCapEnabled" ${app.conditions.marketCapEnabled ? 'checked' : ''} class="w-4 h-4">
                <span>ì‹œê°€ì´ì•¡ ë²”ìœ„</span>
              </label>
              <div class="flex items-center gap-2 ml-6">
                <input type="number" step="1000" id="marketCapMin" value="${app.conditions.marketCapMin / 100000000}" 
                  class="w-24 px-2 py-1 bg-white/20 border border-white/30 rounded text-white text-sm"
                  ${!app.conditions.marketCapEnabled ? 'disabled' : ''}>
                <span class="text-white">~</span>
                <input type="number" step="1000" id="marketCapMax" value="${app.conditions.marketCapMax / 100000000}" 
                  class="w-24 px-2 py-1 bg-white/20 border border-white/30 rounded text-white text-sm"
                  ${!app.conditions.marketCapEnabled ? 'disabled' : ''}>
                <span class="text-blue-300 text-sm">ì–µ</span>
              </div>
            </div>
          </div>

          <div class="mb-6">
            <h3 class="text-base md:text-lg font-semibold text-blue-200 mb-3">ì¬ë¬´ ë¹„ìœ¨</h3>
            <div class="space-y-3">
              <div>
                <label class="flex items-center gap-2 text-white cursor-pointer text-sm mb-2">
                  <input type="checkbox" id="perEnabled" ${app.conditions.perEnabled ? 'checked' : ''} class="w-4 h-4">
                  <span>PER (ì£¼ê°€ìˆ˜ìµë¹„ìœ¨)</span>
                </label>
                <div class="flex items-center gap-2 ml-6">
                  <input type="number" step="1" id="perMin" value="${app.conditions.perMin}" 
                    class="w-20 px-2 py-1 bg-white/20 border border-white/30 rounded text-white text-sm"
                    ${!app.conditions.perEnabled ? 'disabled' : ''}>
                  <span class="text-white">~</span>
                  <input type="number" step="1" id="perMax" value="${app.conditions.perMax}" 
                    class="w-20 px-2 py-1 bg-white/20 border border-white/30 rounded text-white text-sm"
                    ${!app.conditions.perEnabled ? 'disabled' : ''}>
                </div>
              </div>
              <div>
                <label class="flex items-center gap-2 text-white cursor-pointer text-sm mb-2">
                  <input type="checkbox" id="pbrEnabled" ${app.conditions.pbrEnabled ? 'checked' : ''} class="w-4 h-4">
                  <span>PBR (ì£¼ê°€ìˆœìì‚°ë¹„ìœ¨)</span>
                </label>
                <div class="flex items-center gap-2 ml-6">
                  <input type="number" step="0.1" id="pbrMin" value="${app.conditions.pbrMin}" 
                    class="w-20 px-2 py-1 bg-white/20 border border-white/30 rounded text-white text-sm"
                    ${!app.conditions.pbrEnabled ? 'disabled' : ''}>
                  <span class="text-white">~</span>
                  <input type="number" step="0.1" id="pbrMax" value="${app.conditions.pbrMax}" 
                    class="w-20 px-2 py-1 bg-white/20 border border-white/30 rounded text-white text-sm"
                    ${!app.conditions.pbrEnabled ? 'disabled' : ''}>
                </div>
              </div>
            </div>
          </div>

          <button onclick="runScreener()" ${app.loading ? 'disabled' : ''}
            class="w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 disabled:from-gray-500 disabled:to-gray-600 text-white font-bold py-3 px-6 rounded-lg transition-all">
            ${app.loading ? 'ğŸ”„ ê²€ìƒ‰ ì¤‘...' : 'ğŸ” ì¡°ê±´ ê²€ìƒ‰ ì‹¤í–‰'}
          </button>
        </div>

        ${app.error ? `
          <div class="bg-red-500/20 border border-red-500 text-red-200 px-4 py-3 rounded-lg mb-6">
            ${app.error}
          </div>
        ` : ''}

        ${app.results.length > 0 ? `
          <div class="bg-white/10 backdrop-blur-md rounded-xl p-4 md:p-6 border border-white/20">
            <h2 class="text-lg md:text-xl font-bold text-white mb-4">âœ… ê²€ìƒ‰ ê²°ê³¼ (${app.results.length}ê°œ)</h2>
            <div class="overflow-x-auto">
              <table class="w-full text-left text-xs md:text-sm">
                <thead>
                  <tr class="border-b border-white/20">
                    <th class="px-2 py-2 text-blue-200">ì¢…ëª©ëª…</th>
                    <th class="px-2 py-2 text-blue-200">ì¢…ëª©ì½”ë“œ</th>
                    <th class="px-2 py-2 text-blue-200">í˜„ì¬ê°€</th>
                    <th class="px-2 py-2 text-blue-200">ë“±ë½%</th>
                    <th class="px-2 py-2 text-blue-200">112ì¼ì„ </th>
                    <th class="px-2 py-2 text-blue-200">ë¹„ìœ¨</th>
                  </tr>
                </thead>
                <tbody>
                  ${app.results.map(stock => `
                    <tr class="border-b border-white/10 hover:bg-white/5">
                      <td class="px-2 py-2 text-white font-medium">${stock.name}</td>
                      <td class="px-2 py-2 text-gray-300 text-xs">${stock.code}</td>
                      <td class="px-2 py-2 text-white">${parseFloat(stock.currentPrice).toLocaleString()}</td>
                      <td class="px-2 py-2 ${parseFloat(stock.changePercent) >= 0 ? 'text-red-400' : 'text-blue-400'} font-bold">
                        ${stock.changePercent}%
                      </td>
                      <td class="px-2 py-2 text-white">${stock.ma112}</td>
                      <td class="px-2 py-2 text-green-400">${stock.ma112Ratio}%</td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
          </div>
        ` : !app.loading ? `
          <div class="bg-white/5 backdrop-blur-sm rounded-xl p-8 text-center border border-white/10">
            <p class="text-blue-200 text-base md:text-lg">API í‚¤ë¥¼ ì…ë ¥í•˜ê³  ì¡°ê±´ì„ ì„¤ì •í•œ í›„ ê²€ìƒ‰ì„ ì‹¤í–‰í•˜ì„¸ìš”</p>
          </div>
        ` : ''}
      `;

      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
      ['appKey', 'appSecret'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.addEventListener('input', (e) => {
          app[id] = e.target.value;
        });
      });

      ['excludeETF', 'excludeManagement', 'bbEnabled', 'volumeEnabled', 'ma60Enabled', 'ma112Enabled', 'ma224Enabled', 'bbUpperBreak', 'bbLowerBreak', 'maAlignment', 'priceChangeEnabled', 'marketCapEnabled', 'perEnabled', 'pbrEnabled'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.addEventListener('change', (e) => {
          app.conditions[id] = e.target.checked;
          render();
        });
      });

      ['ma60Min', 'ma60Max', 'ma112Min', 'ma112Max', 'ma224Min', 'ma224Max', 'volumeMultiple', 'priceChangeMin', 'priceChangeMax', 'perMin', 'perMax', 'pbrMin', 'pbrMax'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.addEventListener('input', (e) => {
          app.conditions[id] = parseFloat(e.target.value);
        });
      });

      // ì‹œê°€ì´ì•¡ (ì–µì› ë‹¨ìœ„ ë³€í™˜)
      ['marketCapMin', 'marketCapMax'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.addEventListener('input', (e) => {
          app.conditions[id] = parseFloat(e.target.value) * 100000000; // ì–µì› â†’ ì›
        });
      });

      // ë³¼ë¦°ì € ë°´ë“œ í”„ë¦¬ì…‹ ë¼ë””ì˜¤ ë²„íŠ¼
      document.querySelectorAll('input[name="bbPreset"]').forEach(radio => {
        radio.addEventListener('change', (e) => {
          const presets = {
            short: { period: 10, multiplier: 1.5 },
            normal: { period: 20, multiplier: 2 },
            long: { period: 30, multiplier: 3 }
          };
          const preset = presets[e.target.value];
          if (preset) {
            app.conditions.bbPeriod = preset.period;
            app.conditions.bbMultiplier = preset.multiplier;
          }
        });
      });

      const bbPos = document.getElementById('bbPosition');
      if (bbPos) bbPos.addEventListener('change', (e) => {
        app.conditions.bbPosition = e.target.value;
      });
    }

    // ì´ˆê¸° ë Œë”ë§
    render();
  </script>
</body>
</html>
