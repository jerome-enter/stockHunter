# 📻 이동평균선 라디오 버튼 개선 완료!

## ✅ 변경 사항

### 기존 문제 ❌

**1. 중복 선택 가능**
```
☑️ 60일선 활성화
☑️ 112일선 활성화  
☑️ 224일선 활성화
→ 3개 동시 체크 가능 (혼란스러움)
```

**2. 결과 컬럼 고정**
```
테이블 헤더:
| 종목명 | 종목코드 | 현재가 | 등락% | 112일선 | 비율 |
                                    ^^^^^ 항상 112일선만 표시
```

---

## ✅ 개선된 방식

### 1. 라디오 버튼으로 변경 ⭐

```html
<h3>이동평균선 (하나만 선택)</h3>

◉ 60일 이평 ± [95] ~ [105] %
○ 112일 이평 ± [95] ~ [105] %
○ 224일 이평 ± [95] ~ [105] %

→ 하나만 선택 가능!
```

**장점:**
- ✅ 중복 선택 불가
- ✅ 명확한 UX
- ✅ 검색 의도가 명확

---

### 2. 동적 컬럼 표시 ✨

**선택한 기간에 따라 결과 테이블이 변경됩니다!**

#### Case 1: 60일선 선택 시

```
테이블:
| 종목명 | 종목코드 | 현재가 | 등락% | 60일선 | 비율 |
삼성전자  005930   100,000   -1.2%   98,000  102.0%
SK하이닉스 000660  500,000   -0.9%  510,000  98.0%
```

#### Case 2: 112일선 선택 시

```
테이블:
| 종목명 | 종목코드 | 현재가 | 등락% | 112일선 | 비율 |
삼성전자  005930   100,000   -1.2%  95,000   105.3%
SK하이닉스 000660  500,000   -0.9%  520,000  96.2%
```

#### Case 3: 224일선 선택 시

```
테이블:
| 종목명 | 종목코드 | 현재가 | 등락% | 224일선 | 비율 |
삼성전자  005930   100,000   -1.2%  90,000   111.1%
SK하이닉스 000660  500,000   -0.9%  530,000  94.3%
```

---

## 🔧 구현 방식

### JavaScript 헬퍼 함수

```javascript
// 활성화된 이동평균 기간 가져오기
function getActiveMAPeriod() {
  if (app.conditions.ma224Enabled) return 224;
  if (app.conditions.ma112Enabled) return 112;
  if (app.conditions.ma60Enabled) return 60;
  return null;
}

// 이동평균 값 가져오기
function getMAValue(stock, period) {
  const value = stock[`ma${period}`];
  return value !== undefined && value !== null 
    ? parseFloat(value).toLocaleString() 
    : 'N/A';
}

// 이동평균 비율 가져오기
function getMARatio(stock, period) {
  const ratio = stock[`ma${period}Ratio`];
  return ratio !== undefined && ratio !== null 
    ? ratio 
    : 'N/A';
}
```

### 동적 테이블 헤더

```html
<thead>
  <tr>
    <th>종목명</th>
    <th>종목코드</th>
    <th>현재가</th>
    <th>등락%</th>
    ${getActiveMAPeriod() ? `
      <th>${getActiveMAPeriod()}일선</th>
      <th>비율</th>
    ` : ''}
  </tr>
</thead>
```

### 동적 테이블 데이터

```html
<td>${stock.name}</td>
<td>${stock.code}</td>
<td>${stock.currentPrice}</td>
<td>${stock.changePercent}%</td>
${getActiveMAPeriod() ? `
  <td>${getMAValue(stock, getActiveMAPeriod())}</td>
  <td>${getMARatio(stock, getActiveMAPeriod())}%</td>
` : ''}
```

---

## 🎯 사용 예시

### 시나리오 1: 단기 매매 (60일선)

```
조건 설정:
◉ 60일 이평 ± [98] ~ [102] %

검색 결과:
| 종목명 | 60일선 | 비율 |
삼성전자  98,000  102.0%  ← 60일선 바로 위 (매수 타이밍)
카카오    58,000  100.3%  ← 60일선 근처
```

### 시나리오 2: 중기 투자 (112일선)

```
조건 설정:
◉ 112일 이평 ± [95] ~ [105] %

검색 결과:
| 종목명 | 112일선 | 비율 |
네이버   235,000  100.2%  ← 112일선 근처
현대차   288,000   96.5%  ← 112일선 약간 아래 (매수 기회)
```

### 시나리오 3: 장기 투자 (224일선)

```
조건 설정:
◉ 224일 이평 ± [90] ~ [110] %

검색 결과:
| 종목명 | 224일선 | 비율 |
삼성전자  90,000  111.1%  ← 장기 상승 추세
SK하이닉스 530,000  94.3%  ← 224일선 지지 (안정적)
```

---

## 💡 비율의 의미

### 비율 = (현재가 / 이동평균선) × 100

```
100% 초과: 주가가 이평선 위 (강세)
  - 105%: 이평선 대비 5% 위
  - 110%: 이평선 대비 10% 위 (과매수 주의)

100%: 주가가 이평선과 일치 (중립)

100% 미만: 주가가 이평선 아래 (약세)
  - 95%: 이평선 대비 5% 아래
  - 90%: 이평선 대비 10% 아래 (과매도 가능)
```

### 투자 전략

```
매수 타이밍 (이평선 지지):
→ 95~100% (이평선 근처에서 반등)

홀딩 영역:
→ 100~105% (이평선 위에서 안정적 상승)

익절 고려:
→ 110% 이상 (이평선에서 너무 멀어짐, 조정 가능성)
```

---

## 🧪 테스트

### 웹에서 확인

```
http://localhost:3000
```

**1. 조건 설정**
- ◉ 112일 이평 선택
- 범위: 95 ~ 105%

**2. 검색 실행**

**3. 결과 확인**
- 테이블 헤더: **112일선** 표시 ✅
- 각 종목의 112일선 값과 비율 표시 ✅

**4. 조건 변경**
- ◉ 60일 이평으로 변경
- 검색 재실행

**5. 결과 재확인**
- 테이블 헤더: **60일선**으로 변경 ✅
- 각 종목의 60일선 값과 비율 표시 ✅

---

## 🎯 장점 정리

### 1. 명확한 UX ✅
```
라디오 버튼 → 하나만 선택 가능
→ 사용자 의도가 명확
```

### 2. 동적 표시 ✅
```
선택한 기간에 맞는 정보만 표시
→ 혼란 없음, 집중력 향상
```

### 3. 유연성 ✅
```
60일 → 단기 매매
112일 → 중기 투자
224일 → 장기 투자
→ 전략에 맞게 선택
```

### 4. 데이터 정확성 ✅
```
선택한 기간의 실제 MA 값 표시
→ "undefined" 문제 해결
```

---

## 📝 주의사항

### 현재 API 제한 (30일 데이터)

**⚠️ 백엔드 수정 필요:**

현재 스크리너는 API에서 30일 데이터만 가져옵니다:
```kotlin
// StockScreener.kt
val priceResponse = kisApiClient.getDailyPrice(code, days = 30)
→ ma60, ma112, ma224 계산 불가 ❌
```

**해결 방법:**
```kotlin
// DB에서 280일 데이터 가져오기
val prices = database.getPrices(stockCode, days = 280)
→ ma60, ma112, ma224 계산 가능 ✅
```

**현재 상태:**
- UI: 완벽하게 동작 ✅
- 백엔드: DB 연동 필요 ⚠️

---

## 🚀 다음 단계

**백엔드 수정이 필요하면 말씀해주세요!**

1. StockScreener를 DB 기반으로 변경
2. 280일 데이터로 ma60, ma112, ma224 정확하게 계산
3. 완벽한 스크리닝 시스템 완성!

**UI는 이미 준비되어 있습니다!** 🎉
