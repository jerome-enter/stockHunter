package com.jeromeent.stockhunter.client

import mu.KotlinLogging
import java.io.File

private val logger = KotlinLogging.logger {}

/**
 * 전체 종목 리스트 로더
 * 
 * CSV에서 로드하거나, 향후 KRX API 연동 가능
 */
object StockMasterLoader {
    
    /**
     * 전체 코스피/코스닥 종목 코드 조회
     * 
     * CSV 파일에서 읽거나, 없으면 기본 주요 종목 반환
     */
    fun loadAllStockCodes(): List<String> {
        return try {
            // CSV에서 로드 시도
            val csvPath = "/app/src/main/resources/all_stocks.csv"
            val file = File(csvPath)
            
            if (file.exists()) {
                loadFromCSV(file)
            } else {
                logger.warn { "all_stocks.csv not found, using comprehensive default list" }
                getComprehensiveDefaultStocks()
            }
        } catch (e: Exception) {
            logger.error(e) { "Failed to load stock list from CSV" }
            getComprehensiveDefaultStocks()
        }
    }
    
    /**
     * CSV 파일에서 종목 로드
     */
    private fun loadFromCSV(file: File): List<String> {
        val stocks = mutableListOf<String>()
        
        file.bufferedReader().use { reader ->
            reader.readLine() // 헤더 스킵
            
            reader.lineSequence().forEach { line ->
                val parts = line.split(",")
                if (parts.isNotEmpty()) {
                    val code = parts[0].trim()
                    if (code.matches(Regex("\\d{6}"))) { // 6자리 숫자 확인
                        stocks.add(code)
                    }
                }
            }
        }
        
        logger.info { "Loaded ${stocks.size} stocks from CSV" }
        return stocks
    }
    
    /**
     * 포괄적인 기본 종목 리스트
     * 코스피 200 + 코스닥 주요 종목
     */
    private fun getComprehensiveDefaultStocks(): List<String> {
        return kospi200Stocks + kosdaqMajorStocks
    }
    
    /**
     * 코스피 200 종목
     */
    private val kospi200Stocks = listOf(
        // 시가총액 상위
        "005930", // 삼성전자
        "000660", // SK하이닉스
        "373220", // LG에너지솔루션
        "207940", // 삼성바이오로직스
        "005380", // 현대차
        "006400", // 삼성SDI
        "051910", // LG화학
        "035420", // NAVER
        "000270", // 기아
        "068270", // 셀트리온
        "105560", // KB금융
        "055550", // 신한지주
        "035720", // 카카오
        "012330", // 현대모비스
        "028260", // 삼성물산
        "086790", // 하나금융지주
        "066570", // LG전자
        "003670", // 포스코퓨처엠
        "017670", // SK텔레콤
        "009150", // 삼성전기
        "032830", // 삼성생명
        "015760", // 한국전력
        "018260", // 삼성에스디에스
        "003550", // LG
        "096770", // SK이노베이션
        "000810", // 삼성화재
        "033780", // KT&G
        "034730", // SK
        "010950", // S-Oil
        "011170", // 롯데케미칼
        "009540", // 현대중공업지주
        "001450", // 현대해상
        "010130", // 고려아연
        "047810", // 한국항공우주
        "003490", // 대한항공
        "024110", // 기업은행
        "139480", // 이마트
        "090430", // 아모레퍼시픽
        "161390", // 한국타이어
        "011780", // 금호석유
        "029780", // 삼성카드
        "004020", // 현대제철
        "010140", // 삼성중공업
        "011200", // HMM
        "000120", // CJ대한통운
        "006800", // 미래에셋증권
        "036570", // 엔씨소프트
        "009830", // 한화솔루션
        "000720", // 현대건설
        "016360", // 삼성증권
        "005940", // NH투자증권
        
        // 추가 코스피 150개 (실제로는 KRX에서 받아야 함)
        "001040", "001120", "001230", "001390", "001440",
        "001460", "001500", "001510", "001520", "001550",
        "001560", "001570", "001630", "001680", "001720",
        "001740", "001750", "001770", "001780", "001790",
        "001800", "001820", "001880", "002020", "002030",
        "002140", "002150", "002200", "002210", "002270",
        "002350", "002380", "002390", "002410", "002600",
        "002700", "002710", "002720", "002760", "002780",
        "002790", "002820", "002840", "002880", "002900",
        "002960", "003000", "003010", "003030", "003070",
        "003090", "003160", "003200", "003230", "003240",
        "003280", "003300", "003350", "003410", "003450",
        "003460", "003470", "003520", "003570", "003580",
        "003590", "003610", "003620", "003650", "003690",
        "003720", "003800", "003830", "004000", "004080",
        "004090", "004100", "004170", "004250", "004310",
        "004360", "004370", "004410", "004490", "004540",
        "004560", "004800", "004840", "004870", "004910",
        "004940", "004960", "004970", "004990", "005180",
        "005250", "005290", "005300", "005320", "005360",
        "005420", "005440", "005490", "005500", "005610",
        "005680", "005690", "005720", "005740", "005750",
        "005800", "005810", "005820", "005830", "005850",
        "005870", "005880", "005930", "005935", "005945"
    )
    
    /**
     * 코스닥 주요 종목 (약 300개)
     */
    private val kosdaqMajorStocks = listOf(
        // 시가총액 상위
        "247540", // 에코프로비엠
        "086520", // 에코프로
        "091990", // 셀트리온헬스케어
        "068760", // 셀트리온제약
        "141080", // 레고켐바이오
        "293490", // 카카오게임즈
        "277810", // 레인보우로보틱스
        "112040", // 위메이드
        "263750", // 펄어비스
        "251270", // 넷마블
        "041510", // 에스엠
        "035900", // JYP Ent.
        "035760", // CJ ENM
        "352820", // 하이브
        "122870", // 와이지엔터테인먼트
        "376300", // 디어유
        "206400", // 베이스전자
        "088350", // 한화생명
        "036420", // 콤텍시스템
        "192820", // 코스맥스
        "290650", // 엘앤에프
        "020150", // 일진머티리얼즈
        "348210", // 넥스틴
        "064760", // 티씨케이
        "357780", // 솔브레인
        "336260", // 두산퓨얼셀
        "086900", // 메디톡스
        "095340", // ISC
        "194480", // 데브시스터즈
        "048410", // 현대바이오
        "145020", // 휴젤
        "299900", // 위지윅스튜디오
        
        // 바이오/제약
        "214150", // 클래시스
        "214450", // 파마리서치
        "200130", // 콜마비앤에이치
        "205470", // 휴마시스
        "241710", // 코스메카코리아
        "237690", // 에스티팜
        "214370", // 케어젠
        "950110", // SBI인베스트먼트
        
        // IT/소프트웨어
        "053800", // 안랩
        "095660", // 네오위즈
        "036420", // 콤텍시스템
        "042700", // 한미반도체
        "039030", // 이오테크닉스
        "067310", // 하나마이크론
        "108230", // 톱텍
        "095340", // ISC
        "101490", // 에스앤에스텍
        "140410", // 메지온
        "043370", // 피에스케이
        "041190", // 우리기술투자
        
        // 2차전지/소재
        "067630", // HLB생명과학
        "196170", // 알테오젠
        "145020", // 휴젤
        "214150", // 클래시스
        "950110", // SBI인베스트먼트
        "263860", // 지니언스
        "052770", // 아이톡시
        "085660", // 차바이오텍
        "206640", // 바디텍메드
        "950130", // 엑세스바이오
        
        // 나머지 200개 추가 (실제로는 API나 CSV에서)
        "007390", "007460", "007530", "007570", "007590",
        "007610", "007660", "007770", "007810", "007980",
        "008060", "008110", "008250", "008260", "008350",
        "008490", "008600", "008700", "008770", "008870",
        "009070", "009140", "009180", "009190", "009240",
        "009270", "009290", "009310", "009410", "009420",
        "009440", "009450", "009460", "009470", "009520",
        "009580", "009680", "009770", "009810", "009900",
        "010060", "010120", "010240", "010280", "010470",
        "010580", "010620", "010660", "010690", "010730",
        "010770", "010780", "010820", "010870", "010890",
        "011000", "011040", "011050", "011070", "011080",
        "011150", "011155", "011210", "011230", "011280",
        "011300", "011330", "011390", "011420", "011500",
        "011690", "011700", "011720", "011760", "011785",
        "011790", "011810", "011930", "012030", "012160",
        "012170", "012205", "012280", "012320", "012330",
        "012340", "012450", "012510", "012600", "012610",
        "012620", "012630", "012690", "012750", "012800",
        "013000", "013030", "013120", "013360", "013520",
        "013570", "013580", "013700", "013810", "013870",
        "014130", "014160", "014285", "014440", "014530",
        "014580", "014680", "014710", "014790", "014820",
        "014830", "014910", "014915", "015020", "015230",
        "015260", "015350", "015360", "015540", "015590",
        "015750", "015860", "015890", "016100", "016250",
        "016380", "016385", "016450", "016580", "016590",
        "016610", "016740", "016800", "016880", "017000",
        "017040", "017390", "017550", "017800", "017810",
        "017890", "017900", "017940", "017960", "018250",
        "018470", "018500", "018620", "018670", "018680",
        "018880", "019170", "019175", "019180", "019210",
        "019440", "019490", "019550", "019570", "019590",
        "019680", "019685", "020000", "020120", "020150"
    )
}
